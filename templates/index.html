{% extends 'base.html' %}
{% block content %}
<h1 class="text-xl font-bold mb-4">Webcam Feed</h1>
<img src="{{ url_for('webcam.video_feed') }}" width="720"/>

<h2 class="text-lg font-bold mt-4">Recent Scans</h2>
<table class="table-auto w-full border mt-2">
  <tr class="bg-gray-200">
    <th class="px-2 py-1">Code</th>
    <th class="px-2 py-1">Timestamp</th>
  </tr>
  {% for scan in scans %}
  <tr class="border-t">
    <td class="px-2 py-1">{{ scan.code }}</td>
    <td class="px-2 py-1">{{ scan.timestamp }}</td>
  </tr>
  {% endfor %}
</table>

  <div class="mt-4 space-x-2">
    <a href="{{ url_for('cameras.list_cameras') }}" class="bg-gray-800 text-white px-3 py-1">View Cameras</a>
    <a href="{{ url_for('cameras.new_camera_form') }}" class="bg-gray-800 text-white px-3 py-1">Add Camera</a>
  </div>
  <script>
    let lastTime = 0;
    async function checkScan() {
      try {
        const resp = await fetch('{{ url_for('webcam.last_scan') }}');
        if (!resp.ok) return;
        const data = await resp.json();
        const ts = data.lastScannedAt || 0;
        if (ts > lastTime) {
          lastTime = ts;
          document.body.classList.add('scan-success');
          setTimeout(() => {
            document.body.classList.remove('scan-success');
          }, 500);
        }
      } catch (e) {
        // ignore errors
      }
    }
    setInterval(checkScan, 1000);
  </script>
{% endblock %}
